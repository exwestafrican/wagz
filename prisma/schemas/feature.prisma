enum FeatureStage {
  PLANNED // we've committed to doing the work
  IN_PROGRESS // what we are currently working on
  COMPLETED
}

model Feature {
  id            String                @id @default(uuid()) @db.Uuid
  name          String                @unique @db.VarChar(225)
  votes         Int                   @db.SmallInt
  icon          String                @db.VarChar(15) // string that maps to what icon to use name can be found here: https://lucide.dev/icons/
  stage         FeatureStage          @default(PLANNED)
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  subscriptions FeatureSubscription[]
  voteRecords   FeatureVotes[]
}

model FeatureSubscription {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @db.VarChar(255)
  feature   Feature  @relation(fields: [featureId], references: [id], onDelete: Cascade) // Subscriptions deleted when feature is deleted
  featureId String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([email, featureId]) // Composite unique: same email can subscribe to different features
  @@index([email]) // For querying subscriptions by email
  @@index([featureId])
}

enum FeatureRequestPriority {
  LOW
  MEDIUM
  HIGH
}

model FeatureRequest {
  id                   Int                    @id @default(autoincrement())
  description          String                 @db.VarChar(5000)
  requestedByUserEmail String                 @db.VarChar(255) // email of requesting user
  priority             FeatureRequestPriority @default(LOW)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt

  @@index([requestedByUserEmail]) // For querying request by requestedByUserEmail
  @@index([priority]) // For querying request by priority
}

model FeatureVotes {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @db.VarChar(255)
  feature   Feature  @relation(fields: [featureId], references: [id], onDelete: Cascade) // votes deleted when feature is deleted
  featureId String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([email, featureId]) // Composite unique: same email can vote for different features
  @@index([email]) // For querying votes by email
  @@index([featureId])
}
