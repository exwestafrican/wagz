model CompanyProfile {
  id                  Int         @id @default(autoincrement())
  companyName         String      @db.VarChar(255)
  domain              String?     @unique @db.VarChar(100)
  pointOfContactEmail String      @db.VarChar(255)
  phoneCountryCode    String?     @db.VarChar(5) // e.g., "+1", "+44"
  phoneNumber         String?     @db.VarChar(15) // National number without country code
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  workspaces          Workspace[]

  @@index([pointOfContactEmail])
  @@map("company_profiles")
}

enum WorkspaceStatus {
  ACTIVE
  DISABLED
  DELETED
}

model Workspace {
  id               Int               @id @default(autoincrement())
  name             String            @db.VarChar(255)
  status           WorkspaceStatus   @default(ACTIVE)
  ownedBy          CompanyProfile    @relation(fields: [ownedById], references: [id], onDelete: Cascade)
  ownedById        Int
  code             String            @unique @db.VarChar(6)
  hasActivePlan    Boolean           @default(true) //A workspace could be active but not have a plan
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  timezone         String            @default("Africa/Lagos") @db.VarChar(255)
  workspaceInvites WorkspaceInvite[]

  @@map("workspace")
}

enum InviteStatus {
  PENDING
  SENT
  FAILED
  ACCEPTED
}

model WorkspaceInvite {
  id             Int          @id @default(autoincrement())
  recipientEmail String       @db.VarChar(255)
  workspaceCode  String
  workspace      Workspace    @relation(fields: [workspaceCode], references: [code], onDelete: Cascade)
  inviteCode     String       @db.VarChar(6)
  status         InviteStatus @default(PENDING)
  senderId       Int
  recipientRole  String
  sender         Teammate     @relation(fields: [senderId], references: [id], onDelete: Cascade)
  createdAt      DateTime     @default(now())
  validTill      DateTime
  acceptedAt     DateTime?

  @@index([workspaceCode])
  @@map("workspace_invite")
}
